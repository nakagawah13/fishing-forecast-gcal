# Requirements

## 機能要件
- 指定期間の天文潮を取得し、満潮・干潮時刻を算出する
- 潮回り（大潮・中潮・小潮など）を付与する
- Google カレンダーにイベントを作成する
- 直前更新で風速などの予報情報をイベントに追記する

## 非機能要件
- 自動バッチ実行に耐える再実行性
- API 制限を考慮したスロットリング
- 失敗時のリトライと通知
- 設定ファイルによる地点・期間の切替

## 既知の制約
- 天文潮は長期予測可能だが、気象潮は短期予報に依存
- 画像の埋め込みは Google カレンダー仕様に合わせる必要がある（MVP では扱わない）

## 設定ファイル方針（MVP）
- 形式: `config/config.yaml`
- 地点: ホーム 1 地点のみ
- 目的: UI を作らずに運用可能にする（設定変更で対応）
- 遠征対応: 別カレンダーへの登録を前提に運用
- `config/config.yaml` は Git 管理しない（居住地情報の漏洩を避ける）
- `config/config.yaml.template` をコミットし、テンプレート運用とする

## 設定ファイルスキーマ（MVP）
```yaml
settings:
  timezone: "Asia/Tokyo"
  update_interval_hours: 6
  calendar_id: "your_fishing_calendar_id@group.calendar.google.com"
  trips_calendar_id: "your_trips_calendar_id@group.calendar.google.com"

locations:
  - name: "Home"
    latitude: 35.0000
    longitude: 139.0000
    port_code: "PLACEHOLDER"
```

## 決定事項（MVP）
- イベントはテキストのみで運用し、画像は後続フェーズで検討
- 終日イベント + 説明文に詳細時刻を集約（視認性を優先）
- 天文潮の取得は合法性と継続性を優先し、ライセンス確認後に決定
- 計算ライブラリ採用時は公式潮見表で差分検証を行う
- 時合い帯の既定は「満潮前後 2 時間」

## 未決事項
- Google カレンダーのイベント設計（タイトル/本文/タイムゾーン/更新方針）
- イベント ID の制約確認と生成方式
- 公式/準公式データの入手可否と利用規約

## 落とし穴・注意点
- 潮汐データの取得方式により、精度・継続性・料金が大きく変わる
- カレンダー更新は差分更新の設計次第で重複登録が起こりやすい
- 複数地点対応は運用コストとイベント数が急増するため、MVP では避ける
- 設定ファイルを Git 管理すると、居住地情報が漏洩する可能性がある
- 非公式 API やスクレイピングは規約違反や停止のリスクがある
- 時刻イベントはカレンダーの視認性と API 負荷を悪化させるため、MVP では終日イベントのみ
