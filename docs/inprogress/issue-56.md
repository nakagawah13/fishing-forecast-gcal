# Issue #56: ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®æ½®å›ã‚Šçµµæ–‡å­—åŒ–

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: In Progress  
**Phase**: 1.6 (MVPå®‰å®šåŒ–)  
**Priority**: High  
**æ‹…å½“**: AI Assistant  
**é–‹å§‹æ—¥**: 2026-02-08  

---

## èƒŒæ™¯

ç¾çŠ¶ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã¯ã€Œæ½®æ± å·å´ (å°æ½®)ã€ã®ã¿ã§ã€æ½®ã®ç¨®é¡ã®è¦–èªæ€§ãŒä½ã„ã€‚
ã‚¤ãƒ™ãƒ³ãƒˆè‰²ã®å¤‰æ›´ã¯è¤‡æ•°åœ°ç‚¹é‹ç”¨ã§æƒ…å ±éå¤šã«ãªã‚‹ãŸã‚é¿ã‘ãŸã„ã€‚

---

## ç›®æ¨™

ã‚¿ã‚¤ãƒˆãƒ«å…ˆé ­ã«æ½®å›ã‚Šã‚¢ã‚¤ã‚³ãƒ³ï¼ˆçµµæ–‡å­—ï¼‰ã‚’ä»˜ã‘ã¦è¦–èªæ€§ã‚’å¤§å¹…ã«æ”¹å–„ã™ã‚‹ã€‚
- å¤‰æ›´å‰: `æ½®æ± å·å´ (å°æ½®)`
- å¤‰æ›´å¾Œ: `ğŸ”µå·å´ (å°æ½®)` ã¾ãŸã¯ `ğŸ”µå·å´`

---

## è¦ä»¶è©³ç´°

### 1. çµµæ–‡å­—ãƒãƒƒãƒ”ãƒ³ã‚°å®šç¾©

`TideType` ã¨çµµæ–‡å­—ã®å¯¾å¿œè¡¨ï¼š

| æ½®å›ã‚Š | TideType | çµµæ–‡å­— |
|--------|----------|--------|
| å¤§æ½® | SPRING | ğŸ”´ |
| ä¸­æ½® | MODERATE | ğŸŸ  |
| å°æ½® | NEAP | ğŸ”µ |
| é•·æ½® | LONG | âšª |
| è‹¥æ½® | YOUNG | ğŸŸ¢ |

### 2. ã‚¿ã‚¤ãƒˆãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

**æ–°å½¢å¼**: `{emoji}{location_name} ({tide_type})`
- ä¾‹: `ğŸ”µå·å´ (å°æ½®)`
- çµµæ–‡å­—ã¨åœ°ç‚¹åã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ãªã—ï¼ˆè¦–èªæ€§é‡è¦–ï¼‰
- æ‹¬å¼§å†…ã®æ½®å›ã‚Šåã¯ä¿æŒï¼ˆè©³ç´°æƒ…å ±ã¨ã—ã¦ï¼‰

**ç°¡ç•¥ç‰ˆã®æ¤œè¨**:
- `{emoji}{location_name}` ã®ã¿ï¼ˆæ‹¬å¼§ãªã—ï¼‰ã‚‚æ¤œè¨å€™è£œ
- ã—ã‹ã—ã€Issue #56ã®æœŸå¾…ã§ã¯æ‹¬å¼§ã‚ã‚ŠãŒæƒ³å®šã•ã‚Œã¦ã„ã‚‹
- åˆå›å®Ÿè£…ã¯æ‹¬å¼§ã‚ã‚Šã§é€²ã‚ã€UIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã¦èª¿æ•´

### 3. ã‚¤ãƒ™ãƒ³ãƒˆèª¬æ˜æ–‡ã¸ã®çµµæ–‡å­—å‡¡ä¾‹è¿½åŠ 

ã‚¤ãƒ™ãƒ³ãƒˆæœ¬æ–‡ã®æœ€åˆã«ã€çŸ­ã„èª¬æ˜æ–‡ã‚’è¿½åŠ ï¼š
```
ğŸ”´å¤§æ½® ğŸŸ ä¸­æ½® ğŸ”µå°æ½® âšªé•·æ½® ğŸŸ¢è‹¥æ½®

[TIDE]
...
```

- 1è¡Œã®ã¿ã§ç°¡æ½”ã«è¨˜è¼‰
- [TIDE]ä»¥é™ãŒä¸‹ã«ã‚ºãƒ¬ã‚‹ã®ã‚’æœ€å°é™ã«

### 4. æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°æ™‚ã®å¯¾å¿œ

- æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹éš›ã‚‚ã€ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ–°å½¢å¼ã«çµ±ä¸€
- `SyncTideUseCase` ã¯æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã®æ›´æ–°æ™‚ã« `upsert_event()` ã‚’å‘¼ã¶ãŸã‚ã€è‡ªå‹•çš„ã«æ–°ã‚¿ã‚¤ãƒˆãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹

### 5. ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã¯å¤‰æ›´ã—ãªã„

- ã‚¤ãƒ™ãƒ³ãƒˆè‰²ã¯è¤‡æ•°åœ°ç‚¹å¯¾å¿œã§ä½¿ç”¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ä»Šå›ã¯å¤‰æ›´ã—ãªã„
- çµµæ–‡å­—ã®ã¿ã§è¦–èªæ€§ã‚’æ”¹å–„

---

## å®Ÿè£…æ–¹é‡

### A. ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®æ‹¡å¼µ

#### ãƒ•ã‚¡ã‚¤ãƒ«: `src/fishing_forecast_gcal/domain/models/tide.py`

**å¤‰æ›´å†…å®¹**:
- `TideType` ã«çµµæ–‡å­—ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ `to_emoji()` ã‚’è¿½åŠ 

**å®Ÿè£…ä¾‹**:
```python
class TideType(Enum):
    """æ½®å›ã‚Šã®ç¨®é¡"""

    SPRING = "å¤§æ½®"
    MODERATE = "ä¸­æ½®"
    NEAP = "å°æ½®"
    LONG = "é•·æ½®"
    YOUNG = "è‹¥æ½®"

    def to_emoji(self) -> str:
        """æ½®å›ã‚Šç¨®åˆ¥ã«å¯¾å¿œã™ã‚‹çµµæ–‡å­—ã‚’è¿”ã™

        Returns:
            çµµæ–‡å­—æ–‡å­—åˆ—

        Example:
            >>> TideType.SPRING.to_emoji()
            'ğŸ”´'
        """
        emoji_map = {
            TideType.SPRING: "ğŸ”´",
            TideType.MODERATE: "ğŸŸ ",
            TideType.NEAP: "ğŸ”µ",
            TideType.LONG: "âšª",
            TideType.YOUNG: "ğŸŸ¢",
        }
        return emoji_map[self]
```

**ãƒ†ã‚¹ãƒˆ**:
- `tests/unit/domain/models/test_tide.py` ã« `test_tide_type_emoji()` ã‚’è¿½åŠ 
- å…¨5ç¨®é¡ã®çµµæ–‡å­—ãŒæ­£ã—ãè¿”ã‚‹ã“ã¨ã‚’ç¢ºèª

---

### B. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®å¤‰æ›´

#### ãƒ•ã‚¡ã‚¤ãƒ«: `src/fishing_forecast_gcal/application/usecases/sync_tide_usecase.py`

**å¤‰æ›´ç®‡æ‰€1**: ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆï¼ˆ86è¡Œç›®ä»˜è¿‘ï¼‰

**å¤‰æ›´å‰**:
```python
title=f"æ½®æ± {location.name} ({tide.tide_type.value})",
```

**å¤‰æ›´å¾Œ**:
```python
title=f"{tide.tide_type.to_emoji()}{location.name} ({tide.tide_type.value})",
```

**å¤‰æ›´ç®‡æ‰€2**: ã‚¤ãƒ™ãƒ³ãƒˆèª¬æ˜æ–‡ã«çµµæ–‡å­—å‡¡ä¾‹ã‚’è¿½åŠ 

`_build_description()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¤‰æ›´ã—ã€å…ˆé ­ã«çµµæ–‡å­—å‡¡ä¾‹ã‚’æŒ¿å…¥ã€‚

**å¤‰æ›´ä¾‹**:
```python
@staticmethod
def _build_description(tide_section: str, existing_notes: str | None = None) -> str:
    """ã‚¤ãƒ™ãƒ³ãƒˆæœ¬æ–‡ã‚’æ§‹ç¯‰

    Args:
        tide_section: [TIDE]ã‚»ã‚¯ã‚·ãƒ§ãƒ³
        existing_notes: æ—¢å­˜ã®[NOTES]ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆä¿æŒã™ã‚‹å ´åˆï¼‰

    Returns:
        å®Œå…¨ãªã‚¤ãƒ™ãƒ³ãƒˆæœ¬æ–‡
    """
    lines = []

    # çµµæ–‡å­—å‡¡ä¾‹ã‚’å…ˆé ­ã«è¿½åŠ 
    lines.append("ğŸ”´å¤§æ½® ğŸŸ ä¸­æ½® ğŸ”µå°æ½® âšªé•·æ½® ğŸŸ¢è‹¥æ½®")
    lines.append("")

    # æ½®æ±æƒ…å ±
    lines.append("[TIDE]")
    lines.append(tide_section)
    lines.append("")

    # äºˆå ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPhase 2ã§æ‹¡å¼µäºˆå®šï¼‰
    lines.append("[FORECAST]")
    lines.append("ï¼ˆäºˆå ±æ›´æ–°ã¯ Phase 2 ã§å®Ÿè£…äºˆå®šï¼‰")
    lines.append("")

    # ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³
    lines.append("[NOTES]")
    if existing_notes:
        lines.append(existing_notes)
    lines.append("")

    return "\n".join(lines)
```

**ãƒ†ã‚¹ãƒˆ**:
- `tests/unit/application/usecases/test_sync_tide_usecase.py` ã‚’æ›´æ–°
- ã‚¿ã‚¤ãƒˆãƒ«ãŒæ–°å½¢å¼ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
- èª¬æ˜æ–‡ã«çµµæ–‡å­—å‡¡ä¾‹ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

### C. ãƒ†ã‚¹ãƒˆã®å…¨é¢æ›´æ–°

ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ–°å½¢å¼ã«æ›´æ–°ï¼š

1. `tests/unit/application/usecases/test_sync_tide_usecase.py`
   - `test_execute_success()`: ã‚¿ã‚¤ãƒˆãƒ«ã‚’ `ğŸ”´æ±äº¬æ¹¾ (å¤§æ½®)` ã«æ›´æ–°
   - ä»–ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚‚åŒæ§˜ã«æ›´æ–°

2. `tests/unit/infrastructure/repositories/test_calendar_repository.py`
   - ã‚µãƒ³ãƒ—ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’æ–°å½¢å¼ã«æ›´æ–°

3. `tests/unit/domain/models/test_calendar_event.py`
   - ã‚µãƒ³ãƒ—ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’æ–°å½¢å¼ã«æ›´æ–°

4. `tests/e2e/test_sync_tide_flow.py`
   - E2Eãƒ†ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«æ¤œè¨¼ã‚’æ–°å½¢å¼ã«æ›´æ–°
   - `assert event.title.startswith("ğŸ”´æ±äº¬")` ã®ã‚ˆã†ãªå½¢å¼ã«

5. `tests/unit/domain/repositories/test_calendar_repository.py` (interface test)
   - ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ–°å½¢å¼ã«æ›´æ–°

**æ›´æ–°æ–¹é‡**:
- å„åœ°ç‚¹ãƒ»æ½®å›ã‚Šã«å¿œã˜ãŸçµµæ–‡å­—ã‚’ä½¿ç”¨
- ä¾‹: å¤§æ½®ãªã‚‰ `ğŸ”´`, ä¸­æ½®ãªã‚‰ `ğŸŸ `, å°æ½®ãªã‚‰ `ğŸ”µ`

---

## æ¤œè¨¼è¨ˆç”»

### 1. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

- [ ] `TideType.to_emoji()` ãŒå…¨5ç¨®é¡ã§æ­£ã—ã„çµµæ–‡å­—ã‚’è¿”ã™
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆã§çµµæ–‡å­—ãŒå…ˆé ­ã«æ¥ã‚‹
- [ ] èª¬æ˜æ–‡ã«çµµæ–‡å­—å‡¡ä¾‹ãŒå«ã¾ã‚Œã‚‹

### 2. çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] å®Ÿéš›ã®æ½®æ±ãƒ‡ãƒ¼ã‚¿ã§ã‚¤ãƒ™ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã‚‹
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ãŒæ–°å½¢å¼ã«ãªã‚‹

### 3. E2Eãƒ†ã‚¹ãƒˆ

- [ ] å®Ÿã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç™»éŒ²ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãŒæ–°å½¢å¼
- [ ] æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°ã—ãŸéš›ã«ã‚¿ã‚¤ãƒˆãƒ«ãŒå¤‰ã‚ã‚‹

### 4. å“è³ªãƒã‚§ãƒƒã‚¯

- [ ] `uv run ruff format .` ãƒ‘ã‚¹
- [ ] `uv run ruff check .` ãƒ‘ã‚¹
- [ ] `uv run pyright` ãƒ‘ã‚¹ï¼ˆå‹ã‚¨ãƒ©ãƒ¼0ä»¶ï¼‰
- [ ] `uv run pytest` å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹

---

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ãŒçµµæ–‡å­—ä»˜ãã«ãªã‚‹
- [ ] æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚‚æ–°å½¢å¼ã«å¤‰ã‚ã‚‹
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã¯å¤‰æ›´ã—ãªã„
- [ ] èª¬æ˜æ–‡ã«çµµæ–‡å­—å‡¡ä¾‹ãŒè¿½åŠ ã•ã‚Œã‚‹

---

## å½±éŸ¿ç¯„å›²

### å¤‰æ›´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

- **ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤**:
  - `src/fishing_forecast_gcal/domain/models/tide.py` - `TideType.to_emoji()` è¿½åŠ 

- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤**:
  - `src/fishing_forecast_gcal/application/usecases/sync_tide_usecase.py` - ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆã€èª¬æ˜æ–‡ç”Ÿæˆ

- **ãƒ†ã‚¹ãƒˆ**:
  - `tests/unit/domain/models/test_tide.py` - çµµæ–‡å­—ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 
  - `tests/unit/application/usecases/test_sync_tide_usecase.py` - ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
  - `tests/unit/infrastructure/repositories/test_calendar_repository.py` - ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
  - `tests/unit/domain/models/test_calendar_event.py` - ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
  - `tests/unit/domain/repositories/test_calendar_repository.py` - ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
  - `tests/e2e/test_sync_tide_flow.py` - ã‚¿ã‚¤ãƒˆãƒ«æ¤œè¨¼æ›´æ–°

### ç ´å£Šçš„å¤‰æ›´ã®æœ‰ç„¡

**ãªã—**:
- ã‚¿ã‚¤ãƒˆãƒ«å½¢å¼ã®å¤‰æ›´ã ãŒã€APIã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®äº’æ›æ€§ã¯ç¶­æŒ
- æ—¢å­˜ã‚¤ãƒ™ãƒ³ãƒˆã¯æ¬¡å›åŒæœŸæ™‚ã«è‡ªå‹•çš„ã«æ–°å½¢å¼ã«æ›´æ–°ã•ã‚Œã‚‹

---

## TODO / å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `TideType.to_emoji()` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] `TideType.to_emoji()` ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ 
- [ ] `SyncTideUseCase` ã®ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆã‚’å¤‰æ›´
- [ ] `SyncTideUseCase` ã®èª¬æ˜æ–‡ã«çµµæ–‡å­—å‡¡ä¾‹ã‚’è¿½åŠ 
- [ ] å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
- [ ] å“è³ªãƒã‚§ãƒƒã‚¯å®Ÿè¡Œï¼ˆruff, pyright, pytestï¼‰
- [ ] E2Eãƒ†ã‚¹ãƒˆã§å®Ÿã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç™»éŒ²ã—ã¦ç¢ºèª
- [ ] å®Ÿè£…çµæœã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¿½è¨˜
- [ ] docs/completed ã«ç§»å‹•

---

## å‚è€ƒ

- Issue: [#56](https://github.com/nakagawah13/fishing-forecast-gcal/issues/56)
- Implementation Plan: [T-013.6](../implementation_plan.md#t-0136-ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®æ½®å›ã‚Šçµµæ–‡å­—åŒ–)
