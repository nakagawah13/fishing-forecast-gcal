---
applyTo: "**"
---

# Git Workflow: Pull Request Process

このガイドラインは、**プルリクエストの作成とレビュー**に関するプロセスを定義します。

## 関連ガイドライン

- **基本Gitワークフロー**: [git-workflow.instructions.md](./git-workflow.instructions.md)
- **PR作成詳細**: [ai-pull-request.instructions.md](./ai-pull-request.instructions.md)
- **ML実験レビュー**: [git-workflow-ml-experiments.instructions.md](./git-workflow-ml-experiments.instructions.md)

---

## プルリクエスト（PR）

### PRの作成プロセス

#### 1. 作業完了の確認

```bash
# すべての変更がコミット済みか確認
git status

# テストが通過するか確認
pytest  # Python
mvn test  # Java

# Lintエラーがないか確認
ruff check .  # Python
```

#### 2. 最新のmainにリベース（推奨）

```bash
# mainの最新を取得
git switch main
git pull origin main

# 作業ブランチに戻る
git switch feature/your-feature

# リベース
git rebase main

# コンフリクトがある場合は解決
# ... (コンフリクト解決)
git rebase --continue

# リモートに強制プッシュ（既にプッシュ済みの場合）
git push --force-with-lease
```

#### 3. PRの作成

GitHub上でPRを作成し、以下を記載:

**PRタイトル**:
- コミットメッセージと同じ形式
- 例: `feat: add automated model retraining pipeline`

**PR説明テンプレート**:

```markdown
## 変更内容
<!-- 何を変更したか簡潔に -->

## 変更理由
<!-- なぜこの変更が必要か -->

## 影響範囲
<!-- どの部分に影響するか -->

## テスト
<!-- どのようにテストしたか -->
- [ ] ユニットテスト追加
- [ ] 手動テスト実施
- [ ] 既存テストすべて通過

## チェックリスト
- [ ] コードはスタイルガイドに準拠
- [ ] ドキュメントを更新
- [ ] 破壊的変更がある場合、READMEに記載
- [ ] コミットメッセージはConventional Commits準拠

## 関連Issue
Closes #123
Refs #456
```

### PRレビューのガイドライン

ML/AIプロジェクトでは、以下の4つの観点からレビューを実施します。

#### 1. 技術レビュー

**チェックポイント**:
- **機能性**: 意図した動作をするか
- **コード品質**: 読みやすく保守可能か
- **テスト**: 適切なテストがあるか
- **パフォーマンス**: 性能上の問題がないか
- **セキュリティ**: 脆弱性がないか
- **再現性**: 乱数シードが固定されているか

#### 2. 実験レビュー（ML/AI特有）

ML/AI実験のレビューについては、[git-workflow-ml-experiments.instructions.md](./git-workflow-ml-experiments.instructions.md)を参照してください。

**主なチェックポイント**:
- **実験設計**: 実験の目的と仮説が明確か
- **評価指標**: 適切な評価指標が選択されているか
- **ベースライン比較**: 既存モデルとの比較があるか
- **結果の妥当性**: 結果が統計的に有意か
- **過学習チェック**: train/validationの性能差は適切か
- **実験記録**: 実験条件と結果が記録されているか

#### 3. 設定レビュー

**チェックポイント**:
- **ハイパーパラメータ**: 設定値が妥当か、根拠があるか
- **依存関係**: requirements.txtやpyproject.tomlが更新されているか
- **環境変数**: 機密情報がハードコードされていないか
- **設定ファイル**: config/配下のファイルが適切に更新されているか
- **バージョン互換性**: ライブラリバージョンの変更が他に影響しないか

#### 4. ドキュメントレビュー（完整性）

**チェックポイント**:
- **README更新**: 機能追加・変更がREADMEに反映されているか
- **API仕様**: 新しいAPIのドキュメントがあるか
- **インラインコメント**: 複雑なロジックに説明があるか
- **Docstring**: すべての公開関数・クラスにdocstringがあるか
- **変更履歴**: 破壊的変更がCHANGELOGに記載されているか
- **実験ノート**: 実験結果と考察が記録されているか

**レビューコメントの例**:

```markdown
# 承認
LGTM! (Looks Good To Me)

# 軽微な指摘
nit: 変数名を `data` から `input_data` に変更すると意図が明確になります

# 重要な指摘
⚠️ この変更はnullチェックが不足しており、NullPointerExceptionが発生する可能性があります。
```

### マージ方法

#### マージ戦略の選択

| 戦略 | 説明 | 使用ケース |
|------|------|-----------|
| **Merge commit** | マージコミットを作成 | 複数コミットの履歴を保持したい場合 |
| **Squash and merge** | すべてのコミットを1つに圧縮 | PRのコミット履歴を整理したい場合（推奨） |
| **Rebase and merge** | リベースしてマージ | 線形な履歴を維持したい場合 |

**このプロジェクトでは**: **Squash and merge** を推奨

#### マージ前の最終チェック

```bash
# CIが通過しているか確認
# GitHub Actions のステータスを確認

# コンフリクトがないか確認
# GitHub PR画面で確認

# 少なくとも1人のレビュアーの承認を得る
```

---

## コードレビューのベストプラクティス

### レビュアー向け

**効果的なレビューコメント**:

```markdown
# 具体的な提案
💡 `for` ループの代わりにリスト内包表記を使うと可読性が向上します:
```python
result = [transform(x) for x in data if x > 0]
```

# 質問形式
❓ この関数が空のリストを受け取った場合の動作は意図通りですか?

# 称賛
👍 エラーハンドリングが適切で、わかりやすいエラーメッセージになっています!
```

**レビューの優先順位**:

1. **Critical**: セキュリティ、バグ、データ損失の可能性
2. **Important**: パフォーマンス、保守性、設計
3. **Nice to have**: スタイル、命名、コメント

### PR作成者向け

**レビューを受けやすくする工夫**:

1. **小さなPR**: 300行以下を目安
2. **明確な説明**: 背景と意図を記載
3. **セルフレビュー**: 提出前に自分で確認
4. **コメント追加**: 複雑な箇所に説明を追加

**レビューコメントへの対応**:

```markdown
# 対応完了
✅ 修正しました。`calculate_rate`関数にnullチェックを追加しました。

# 対応しない理由を説明
🤔 ご指摘ありがとうございます。今回はパフォーマンス上の理由で現在の実装を維持しますが、
   将来的な最適化として Issue #789 を作成しました。

# 追加の説明が必要
❓ この部分の意図がわからなかったので、もう少し詳しく教えていただけますか?
```
