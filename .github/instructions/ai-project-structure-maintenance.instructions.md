---
applyTo: "**"
---

# AIプロジェクト構造保護ガイドライン（保守・修正）

## 概要

このファイルは、既存プロジェクト構造の問題に対する修正プロセスとエラーパターンの対処法を定義します。構造破綻の予防と修正の手順を規定します。

## 関連ガイドライン

- [ai-project-structure-core.instructions.md](./ai-project-structure-core.instructions.md): コア・必須ルール
- [ai-project-structure-ml.instructions.md](./ai-project-structure-ml.instructions.md): ML/AI特有の構造ルール

## エラーパターンと対処法

### エラーパターン1: 衝動的な作成

**症状**:
- 検索せずに即座にディレクトリを作成
- 既存構造を確認しない
- 「とりあえず」で作成

**対処法**:
1. STOP-SEARCH-ANALYZE-CONFIRM-CREATE プロセスを厳守
2. 必ず `tree` コマンドと `grep_search` を実行
3. 既存構造との整合性を確認

**予防策**: 作成前に必ず既存構造を確認する習慣をつける

### エラーパターン2: 重複ディレクトリの無自覚な作成

**症状**:
- `utils/` と `utilities/` が併存
- `config/` と `src/config/` が併存
- 単数形と複数形が混在

**対処法**:
1. 重複パターンチェックリストで確認
2. `grep_search` で類似名称を検索
3. 既存ディレクトリを優先的に使用

**予防策**: 重複禁止パターンを常に意識する

### エラーパターン3: 一時的なディレクトリの放置

**症状**:
- `temp/` や `test_folder/` が残存
- 実験的なディレクトリが削除されない
- 「後で削除する」が実行されない

**対処法**:
1. 一時的なディレクトリは作成しない
2. 必要な場合は `.gitignore` で除外
3. 定期的なクリーンアップ

**予防策**: 作成禁止ディレクトリリストを遵守

### エラーパターン4: 命名規則の不統一

**症状**:
- snake_case と kebab-case が混在
- 略語と完全形が混在
- 英語と日本語が混在

**対処法**:
1. プロジェクトの命名規則を確認
2. 既存ディレクトリの命名パターンに従う
3. チームの慣習を尊重

**予防策**: 既存構造を参考にする

## 既存構造修正プロセス（SHOULD）

既に重複や問題のあるディレクトリが存在する場合の対処法。

### 修正の優先度

1. **高優先度（即座に対応）**:
   - 明確な重複ディレクトリ（`utils/` と `utilities/`）
   - 一時的なディレクトリの残存（`temp/`, `test/`）
   - ML/AI構造の重大な違反（モデルとコードの混在）

2. **中優先度（計画的に対応）**:
   - 命名規則の不統一
   - 階層の不整合
   - 非標準的なディレクトリ名

3. **低優先度（余裕があれば対応）**:
   - 軽微な命名の改善
   - ドキュメント整備
   - README追加

### 修正手順

#### ステップ1: 問題の特定

```bash
# 既存構造を確認
tree コマンドで全体構造を視覚的に把握

# 重複を検索
grep_search で類似名称を検索

# 問題リストを作成
- 重複ディレクトリ
- 一時的ディレクトリ
- 命名規則違反
```

#### ステップ2: 修正計画の策定

```markdown
修正計画:
1. utilities/ を削除、utils/ に統合
2. temp/ を削除
3. src/config/ を config/ に統合
4. 影響範囲の確認（import文、パス参照）
```

#### ステップ3: バックアップ

```bash
# Gitでブランチ作成
git switch -c refactor/fix-directory-structure

# 必要に応じて追加のバックアップ
```

#### ステップ4: 段階的な修正

```bash
# 一度に全て修正せず、段階的に実施
1. まず utilities/ の内容を utils/ に移動
   # ファイル・ディレクトリの移動は git mv を使用
   git mv src/utilities/helper.py src/utils/helper.py
   
2. import文を修正
   # コード内のimport文、パス参照を更新
   
3. テスト実行
   # 変更が正しく動作するか確認
   
4. utilities/ を削除（空ディレクトリの場合）
   # 空ディレクトリの削除は git rm -r を使用
   git rm -r src/utilities/
   
5. コミット
   git commit -m "refactor: utilities/ を utils/ に統合"
```

**重要**: ファイル・ディレクトリの移動・削除時の必須ルール
- **移動**: `git mv` を使用（履歴を保持）
- **削除**: `git rm -r` を使用（ディレクトリごと削除）
- 通常の `mv` や `rm` コマンドは使用しない（Git履歴が途切れる）

#### ステップ5: 検証

```bash
# 動作確認
- ビルド成功
- テスト成功
- 機能が正常動作

# コードレビュー
- チームメンバーに確認依頼
```

#### ステップ6: ドキュメント更新

```markdown
# README.mdやドキュメントを更新
- 新しいディレクトリ構造を記載
- 移行理由を説明
- 影響範囲を明記
```

### 修正時の注意事項

**DO（すべきこと）**:
- 必ずバックアップを取る
- 段階的に修正する
- テストを実行する
- チームに共有する
- ドキュメントを更新する

**DON'T（してはいけないこと）**:
- 一度に大量の修正をしない
- テストなしで修正しない
- チームに相談せず修正しない
- 影響範囲を確認せず削除しない

### 修正が困難な場合

既存構造の修正が困難（影響範囲が大きい、リスクが高い）な場合:

1. **現状維持**: 既存構造を維持し、新規作成時のみルール適用
2. **段階的移行**: 時間をかけて少しずつ修正
3. **ドキュメント化**: 問題点をドキュメント化し、将来の改善課題として記録
4. **チームと相談**: 優先度と実施時期を協議

**重要**: 無理に修正してシステムを壊すより、現状を受け入れて新規作成時にルールを守る方が賢明な場合もある。
